<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Call Analytics Dashboard</title>
    
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.dataTables.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
    
    <!-- PapaParse for CSV -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            color: white;
        }
        
        h1 {
            font-size: 3rem;
            font-weight: 800;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.3rem;
            opacity: 0.95;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .project-info {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            color: white;
            border: 2px solid rgba(255,255,255,0.2);
        }
        
        .project-info h3 {
            color: white !important;
            background: none !important;
            padding: 0 !important;
            margin-bottom: 15px !important;
            border: none !important;
            font-size: 1.2rem;
        }
        
        .project-info p {
            margin: 8px 0;
            line-height: 1.6;
            font-size: 0.95rem;
        }
        
        .project-info strong {
            color: #ffd93d;
        }
        
        /* Metrics Cards */
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .metric-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }
        
        .metric-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 600;
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .metric-subtitle {
            font-size: 0.85rem;
            color: #999;
            margin-top: 5px;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .tab {
            background: white;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }
        
        .tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 8px 25px rgba(102,126,234,0.4);
        }
        
        /* Content Sections */
        .content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin: 20px 0;
            display: none;
        }
        
        .content.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Filters */
        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
            border-radius: 10px;
        }
        
        .filter-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .filter-group select,
        .filter-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: #764ba2;
            box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
        }
        
        /* Buttons */
        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102,126,234,0.4);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102,126,234,0.6);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #11998e, #38ef7d);
            box-shadow: 0 4px 15px rgba(17,153,142,0.4);
        }
        
        /* DataTable Custom Styling */
        .dataTables_wrapper {
            padding: 20px 0;
        }
        
        table.dataTable {
            border-collapse: collapse;
            width: 100% !important;
        }
        
        table.dataTable thead th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            font-weight: 600;
            text-align: left;
        }
        
        table.dataTable tbody td {
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        table.dataTable tbody tr:hover {
            background: #f8f9ff;
        }
        
        /* Lead Badge */
        .badge-lead {
            background: #38ef7d;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        /* Sentiment Badges */
        .badge-positive {
            background: #38ef7d;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .badge-neutral {
            background: #ffd93d;
            color: #333;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .badge-negative {
            background: #ff6b6b;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        /* Priority Badges */
        .badge-high {
            background: #ff6b6b;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .badge-medium {
            background: #ffd93d;
            color: #333;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .badge-low {
            background: #95e1d3;
            color: #333;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        /* Charts */
        .charts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin: 25px 0;
        }
        
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .chart-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #2c3e50;
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.5rem;
            color: white;
        }
        
        .spinner {
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            h1 { font-size: 2rem; }
            .metrics { grid-template-columns: 1fr; }
            .charts { grid-template-columns: 1fr; }
            .tabs { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Call Analytics Dashboard</h1>
            <p class="subtitle">AI-Powered Call Transcript Analysis System</p>
            <div class="project-info">
                <h3>Powered by Google Gemini 2.0 Flash</h3>
                <p><strong>Project:</strong> Information Extraction Pipeline for Automobile Service Center Calls</p>
                <p><strong>Data:</strong> 100 call transcripts in multiple languages (Hindi, Tamil, Kannada, Marathi, Malayalam, Punjabi)</p>
                <!-- <p><strong>Technology Stack:</strong> Gemini 2.0 Flash API + Python + Regex Pattern Matching</p> -->
                <!-- <p><strong>Extraction:</strong> 28 structured fields per call including sentiment, intent, leads, priority, agent performance</p> -->
                <p><strong>Success Rate:</strong> 99% (99/100 calls successfully extracted)</p>
                <p><strong>Method:</strong> Romanized English transcripts ‚Üí LLM prompt with JSON schema ‚Üí Structured output ‚Üí Enhanced with regex patterns</p>
            </div>
        </header>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Loading data...</p>
        </div>
        
        <div id="dashboard" style="display: none;">
            <!-- Key Metrics -->
            <div class="metrics" id="metrics"></div>
            
            <!-- Tabs -->
            <div class="tabs">
                <div class="tab active" onclick="showTab('csv')">üìã VIEW CSV DATA</div>
                <div class="tab" onclick="showTab('overview')">üìä Overview</div>
                <div class="tab" onclick="showTab('leads')">üíº Leads</div>
                <div class="tab" onclick="showTab('sentiment')">üòä Sentiment</div>
                <div class="tab" onclick="showTab('performance')">üéØ Performance</div>
            </div>
            
            <!-- CSV Data Tab -->
            <div class="content active" id="csv-content">
                <h2 style="margin-bottom: 20px;">üìã Complete CSV Data</h2>
                
                <!-- Filters -->
                <div class="filters">
                    <div class="filter-group">
                        <label>üîç Search All Columns</label>
                        <input type="text" id="globalSearch" placeholder="Type to search...">
                    </div>
                    <div class="filter-group">
                        <label>üåê Language</label>
                        <select id="filterLanguage">
                            <option value="">All Languages</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>üòä Sentiment</label>
                        <select id="filterSentiment">
                            <option value="">All Sentiments</option>
                            <option value="positive">Positive</option>
                            <option value="neutral">Neutral</option>
                            <option value="negative">Negative</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>üíº Lead Status</label>
                        <select id="filterLead">
                            <option value="">All</option>
                            <option value="true">Leads Only</option>
                            <option value="false">Non-Leads</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>‚ö° Priority</label>
                        <select id="filterPriority">
                            <option value="">All Priorities</option>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                </div>
                
                <div style="margin: 20px 0;">
                    <button class="btn btn-success" onclick="exportToCSV()">üì• Export to CSV</button>
                    <button class="btn" onclick="resetFilters()">üîÑ Reset Filters</button>
                </div>
                
                <table id="dataTable" class="display" style="width:100%"></table>
            </div>
            
            <!-- Overview Tab -->
            <div class="content" id="overview-content">
                <h2 style="margin-bottom: 20px;">üìä Overview Analytics</h2>
                <div class="charts">
                    <div class="chart-container">
                        <div class="chart-title">Language Distribution</div>
                        <canvas id="languageChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">Issue Categories</div>
                        <canvas id="categoryChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">Priority Distribution</div>
                        <canvas id="priorityChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">Urgency Levels</div>
                        <canvas id="urgencyChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Leads Tab -->
            <div class="content" id="leads-content">
                <h2 style="margin-bottom: 20px;">üíº Lead Analysis</h2>
                <div class="charts">
                    <div class="chart-container">
                        <div class="chart-title">Leads by Language</div>
                        <canvas id="leadsLanguageChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">Leads by Category</div>
                        <canvas id="leadsCategoryChart"></canvas>
                    </div>
                </div>
                <div style="margin-top: 30px;">
                    <h3 style="margin-bottom: 15px;">üî• Hot Leads (High Priority + High Urgency)</h3>
                    <div id="hotLeadsTable"></div>
                </div>
            </div>
            
            <!-- Sentiment Tab -->
            <div class="content" id="sentiment-content">
                <h2 style="margin-bottom: 20px;">üòä Sentiment Analysis</h2>
                <div class="charts">
                    <div class="chart-container">
                        <div class="chart-title">Overall Sentiment</div>
                        <canvas id="sentimentChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">Sentiment by Language</div>
                        <canvas id="sentimentLanguageChart"></canvas>
                    </div>
                </div>
                <div style="margin-top: 30px;">
                    <h3 style="margin-bottom: 15px;">‚ö†Ô∏è Negative Sentiment Calls (Action Required)</h3>
                    <div id="negativeCalls"></div>
                </div>
            </div>
            
            <!-- Performance Tab -->
            <div class="content" id="performance-content">
                <h2 style="margin-bottom: 20px;">üéØ Agent Performance</h2>
                <div class="charts">
                    <div class="chart-container">
                        <div class="chart-title">Performance Distribution</div>
                        <canvas id="performanceChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">Performance by Language</div>
                        <canvas id="performanceLanguageChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let csvData = [];
        let dataTable;
        
        // Load CSV data
        // For GitHub Pages: use 'extracted_calls.csv' (file in root)
        // For local: use 'outputs/extracted_calls.csv'
        Papa.parse('outputs/extracted_calls.csv', {
            download: true,
            header: true,
            complete: function(results) {
                csvData = results.data;
                initializeDashboard();
            },
            error: function(error) {
                document.getElementById('loading').innerHTML = '<p>‚ùå Error loading CSV file. Make sure outputs/extracted_calls.csv exists!</p>';
            }
        });
        
        function initializeDashboard() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            
            updateMetrics();
            initializeDataTable();
            populateFilters();
            createCharts();
        }
        
        function updateMetrics() {
            const totalCalls = csvData.length;
            const leads = csvData.filter(row => 
                row.is_lead === 'True' || row.is_lead === 'true' || row.is_lead === true
            ).length;
            const highPriority = csvData.filter(row => row.priority === 'high').length;
            const negative = csvData.filter(row => row.sentiment === 'negative').length;
            const successRate = (csvData.filter(row => row.extraction_status === 'success').length / totalCalls * 100).toFixed(1);
            
            document.getElementById('metrics').innerHTML = `
                <div class="metric-card">
                    <div class="metric-label">Total Calls</div>
                    <div class="metric-value">${totalCalls}</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Leads</div>
                    <div class="metric-value">${leads}</div>
                    <div class="metric-subtitle">${(leads/totalCalls*100).toFixed(1)}% conversion</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">High Priority</div>
                    <div class="metric-value">${highPriority}</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Negative Sentiment</div>
                    <div class="metric-value">${negative}</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Success Rate</div>
                    <div class="metric-value">${successRate}%</div>
                </div>
            `;
        }
        
        function initializeDataTable() {
            const columns = Object.keys(csvData[0]).map(key => ({
                title: key.replace(/_/g, ' ').toUpperCase(),
                data: key,
                render: function(data, type, row) {
                    if (key === 'is_lead') {
                        if (data === 'True' || data === 'true' || data === true) {
                            return '<span class="badge-lead">‚úì LEAD</span>';
                        }
                        return '<span style="color: #999;">-</span>';
                    }
                    if (key === 'sentiment' && data) {
                        return `<span class="badge-${data.toLowerCase()}">${data.toUpperCase()}</span>`;
                    }
                    if (key === 'priority' && data) {
                        return `<span class="badge-${data.toLowerCase()}">${data.toUpperCase()}</span>`;
                    }
                    if (key === 'call_summary' && data && data.length > 150) {
                        return data.substring(0, 150) + '...';
                    }
                    if (key === 'sentiment_score' && data) {
                        return parseFloat(data).toFixed(2);
                    }
                    return data || '-';
                }
            }));
            
            dataTable = $('#dataTable').DataTable({
                data: csvData,
                columns: columns,
                pageLength: 25,
                dom: 'Bfrtip',
                buttons: ['csv', 'excel'],
                scrollX: true,
                order: [[0, 'asc']]
            });
            
            // Global search
            $('#globalSearch').on('keyup', function() {
                dataTable.search(this.value).draw();
            });
            
            // Filter handlers
            $('#filterLanguage, #filterSentiment, #filterLead, #filterPriority').on('change', function() {
                applyFilters();
            });
        }
        
        function populateFilters() {
            const languages = [...new Set(csvData.map(row => row.original_language))].sort();
            const languageSelect = document.getElementById('filterLanguage');
            languages.forEach(lang => {
                const option = document.createElement('option');
                option.value = lang;
                option.textContent = lang;
                languageSelect.appendChild(option);
            });
        }
        
        function applyFilters() {
            let filtered = csvData;
            
            const lang = document.getElementById('filterLanguage').value;
            const sentiment = document.getElementById('filterSentiment').value;
            const lead = document.getElementById('filterLead').value;
            const priority = document.getElementById('filterPriority').value;
            
            if (lang) filtered = filtered.filter(row => row.original_language === lang);
            if (sentiment) filtered = filtered.filter(row => row.sentiment === sentiment);
            if (lead === 'true') {
                filtered = filtered.filter(row => row.is_lead === 'True' || row.is_lead === 'true' || row.is_lead === true);
            } else if (lead === 'false') {
                filtered = filtered.filter(row => row.is_lead === 'False' || row.is_lead === 'false' || row.is_lead === false);
            }
            if (priority) filtered = filtered.filter(row => row.priority === priority);
            
            dataTable.clear();
            dataTable.rows.add(filtered);
            dataTable.draw();
        }
        
        function resetFilters() {
            document.getElementById('filterLanguage').value = '';
            document.getElementById('filterSentiment').value = '';
            document.getElementById('filterLead').value = '';
            document.getElementById('filterPriority').value = '';
            document.getElementById('globalSearch').value = '';
            dataTable.clear();
            dataTable.rows.add(csvData);
            dataTable.draw();
        }
        
        function exportToCSV() {
            const csv = Papa.unparse(dataTable.rows({search: 'applied'}).data().toArray());
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'filtered_calls.csv';
            a.click();
        }
        
        function createCharts() {
            // Language Chart
            const langCounts = {};
            csvData.forEach(row => {
                if (row.original_language) {
                    langCounts[row.original_language] = (langCounts[row.original_language] || 0) + 1;
                }
            });
            new Chart(document.getElementById('languageChart'), {
                type: 'pie',
                data: {
                    labels: Object.keys(langCounts),
                    datasets: [{
                        data: Object.values(langCounts),
                        backgroundColor: ['#667eea', '#764ba2', '#f093fb', '#4facfe', '#43e97b', '#fa709a', '#fee140']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'right' }
                    }
                }
            });
            
            // Category Chart
            const catCounts = {};
            csvData.forEach(row => {
                if (row.issue_category) {
                    catCounts[row.issue_category] = (catCounts[row.issue_category] || 0) + 1;
                }
            });
            new Chart(document.getElementById('categoryChart'), {
                type: 'bar',
                data: {
                    labels: Object.keys(catCounts),
                    datasets: [{
                        label: 'Number of Calls',
                        data: Object.values(catCounts),
                        backgroundColor: '#667eea',
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
            
            // Priority Chart
            const priorityCounts = {high: 0, medium: 0, low: 0};
            csvData.forEach(row => {
                const p = row.priority ? row.priority.toLowerCase() : '';
                if (priorityCounts.hasOwnProperty(p)) {
                    priorityCounts[p]++;
                }
            });
            new Chart(document.getElementById('priorityChart'), {
                type: 'doughnut',
                data: {
                    labels: ['High', 'Medium', 'Low'],
                    datasets: [{
                        data: [priorityCounts.high, priorityCounts.medium, priorityCounts.low],
                        backgroundColor: ['#ff6b6b', '#ffd93d', '#95e1d3']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
            
            // Urgency Chart
            const urgencyCounts = {high: 0, medium: 0, low: 0};
            csvData.forEach(row => {
                const u = row.urgency ? row.urgency.toLowerCase() : '';
                if (urgencyCounts.hasOwnProperty(u)) {
                    urgencyCounts[u]++;
                }
            });
            new Chart(document.getElementById('urgencyChart'), {
                type: 'bar',
                data: {
                    labels: ['High', 'Medium', 'Low'],
                    datasets: [{
                        label: 'Calls',
                        data: [urgencyCounts.high, urgencyCounts.medium, urgencyCounts.low],
                        backgroundColor: ['#ff6b6b', '#ffd93d', '#95e1d3'],
                        borderRadius: 8
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
            
            // Sentiment Chart
            const sentCounts = {positive: 0, neutral: 0, negative: 0};
            csvData.forEach(row => {
                const s = row.sentiment ? row.sentiment.toLowerCase() : '';
                if (sentCounts.hasOwnProperty(s)) {
                    sentCounts[s]++;
                }
            });
            new Chart(document.getElementById('sentimentChart'), {
                type: 'pie',
                data: {
                    labels: ['Positive', 'Neutral', 'Negative'],
                    datasets: [{
                        data: [sentCounts.positive, sentCounts.neutral, sentCounts.negative],
                        backgroundColor: ['#38ef7d', '#ffd93d', '#ff6b6b']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
            
            // Sentiment by Language
            const langSentiment = {};
            csvData.forEach(row => {
                if (row.original_language && row.sentiment) {
                    if (!langSentiment[row.original_language]) {
                        langSentiment[row.original_language] = {positive: 0, neutral: 0, negative: 0};
                    }
                    const s = row.sentiment.toLowerCase();
                    if (langSentiment[row.original_language][s] !== undefined) {
                        langSentiment[row.original_language][s]++;
                    }
                }
            });
            
            new Chart(document.getElementById('sentimentLanguageChart'), {
                type: 'bar',
                data: {
                    labels: Object.keys(langSentiment),
                    datasets: [
                        {
                            label: 'Positive',
                            data: Object.values(langSentiment).map(v => v.positive),
                            backgroundColor: '#38ef7d'
                        },
                        {
                            label: 'Neutral',
                            data: Object.values(langSentiment).map(v => v.neutral),
                            backgroundColor: '#ffd93d'
                        },
                        {
                            label: 'Negative',
                            data: Object.values(langSentiment).map(v => v.negative),
                            backgroundColor: '#ff6b6b'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: { stacked: true },
                        y: { stacked: true }
                    }
                }
            });
            
            // Performance Chart
            const perfCounts = {good: 0, average: 0, poor: 0};
            csvData.forEach(row => {
                const p = row.agent_performance ? row.agent_performance.toLowerCase() : '';
                if (perfCounts.hasOwnProperty(p)) {
                    perfCounts[p]++;
                }
            });
            new Chart(document.getElementById('performanceChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Good', 'Average', 'Poor'],
                    datasets: [{
                        data: [perfCounts.good, perfCounts.average, perfCounts.poor],
                        backgroundColor: ['#38ef7d', '#ffd93d', '#ff6b6b']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
            
            // Performance by Language
            const langPerf = {};
            csvData.forEach(row => {
                if (row.original_language && row.agent_performance) {
                    if (!langPerf[row.original_language]) {
                        langPerf[row.original_language] = {good: 0, average: 0, poor: 0};
                    }
                    const p = row.agent_performance.toLowerCase();
                    if (langPerf[row.original_language][p] !== undefined) {
                        langPerf[row.original_language][p]++;
                    }
                }
            });
            
            new Chart(document.getElementById('performanceLanguageChart'), {
                type: 'bar',
                data: {
                    labels: Object.keys(langPerf),
                    datasets: [
                        {
                            label: 'Good',
                            data: Object.values(langPerf).map(v => v.good),
                            backgroundColor: '#38ef7d'
                        },
                        {
                            label: 'Average',
                            data: Object.values(langPerf).map(v => v.average),
                            backgroundColor: '#ffd93d'
                        },
                        {
                            label: 'Poor',
                            data: Object.values(langPerf).map(v => v.poor),
                            backgroundColor: '#ff6b6b'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: { stacked: true },
                        y: { stacked: true }
                    }
                }
            });
            
            // Leads Charts
            const leadsData = csvData.filter(row => row.is_lead === 'True' || row.is_lead === 'true' || row.is_lead === true);
            
            const leadsLang = {};
            leadsData.forEach(row => {
                if (row.original_language) {
                    leadsLang[row.original_language] = (leadsLang[row.original_language] || 0) + 1;
                }
            });
            
            new Chart(document.getElementById('leadsLanguageChart'), {
                type: 'bar',
                data: {
                    labels: Object.keys(leadsLang),
                    datasets: [{
                        label: 'Number of Leads',
                        data: Object.values(leadsLang),
                        backgroundColor: '#38ef7d',
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
            
            const leadsCat = {};
            leadsData.forEach(row => {
                if (row.issue_category) {
                    leadsCat[row.issue_category] = (leadsCat[row.issue_category] || 0) + 1;
                }
            });
            
            new Chart(document.getElementById('leadsCategoryChart'), {
                type: 'pie',
                data: {
                    labels: Object.keys(leadsCat),
                    datasets: [{
                        data: Object.values(leadsCat),
                        backgroundColor: ['#38ef7d', '#11998e', '#43e97b', '#30e3ca', '#2dd4bf']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'right' }
                    }
                }
            });
            
            // Hot Leads Table
            const hotLeads = csvData.filter(row => 
                (row.is_lead === 'True' || row.is_lead === 'true' || row.is_lead === true) &&
                row.priority === 'high' &&
                row.urgency === 'high'
            );
            
            let hotLeadsHTML = hotLeads.length > 0 ? '<table style="width:100%; border-collapse: collapse;">' +
                '<tr style="background: #667eea; color: white;">' +
                '<th style="padding: 10px; text-align: left;">Row</th>' +
                '<th style="padding: 10px; text-align: left;">Language</th>' +
                '<th style="padding: 10px; text-align: left;">Summary</th>' +
                '<th style="padding: 10px; text-align: left;">Car Model</th>' +
                '<th style="padding: 10px; text-align: left;">Next Action</th>' +
                '</tr>' : '<p style="color: #999;">No hot leads found.</p>';
            
            hotLeads.forEach(row => {
                hotLeadsHTML += `<tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 10px;">${row.row_index}</td>
                    <td style="padding: 10px;">${row.original_language}</td>
                    <td style="padding: 10px;">${(row.call_summary || '').substring(0, 100)}...</td>
                    <td style="padding: 10px;">${row.car_model || '-'}</td>
                    <td style="padding: 10px;">${row.next_action || '-'}</td>
                </tr>`;
            });
            
            if (hotLeads.length > 0) hotLeadsHTML += '</table>';
            document.getElementById('hotLeadsTable').innerHTML = hotLeadsHTML;
            
            // Negative Calls Table
            const negativeCalls = csvData.filter(row => row.sentiment === 'negative');
            
            let negativeHTML = negativeCalls.length > 0 ? '<table style="width:100%; border-collapse: collapse;">' +
                '<tr style="background: #ff6b6b; color: white;">' +
                '<th style="padding: 10px; text-align: left;">Row</th>' +
                '<th style="padding: 10px; text-align: left;">Language</th>' +
                '<th style="padding: 10px; text-align: left;">Summary</th>' +
                '<th style="padding: 10px; text-align: left;">Issue</th>' +
                '<th style="padding: 10px; text-align: left;">Priority</th>' +
                '</tr>' : '<p style="color: #999;">No negative sentiment calls found.</p>';
            
            negativeCalls.forEach(row => {
                negativeHTML += `<tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 10px;">${row.row_index}</td>
                    <td style="padding: 10px;">${row.original_language}</td>
                    <td style="padding: 10px;">${(row.call_summary || '').substring(0, 100)}...</td>
                    <td style="padding: 10px;">${row.issue_category || '-'}</td>
                    <td style="padding: 10px;"><span class="badge-${row.priority}">${row.priority || '-'}</span></td>
                </tr>`;
            });
            
            if (negativeCalls.length > 0) negativeHTML += '</table>';
            document.getElementById('negativeCalls').innerHTML = negativeHTML;
        }
        
        function showTab(tabName) {
            // Hide all content
            document.querySelectorAll('.content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected content
            document.getElementById(tabName + '-content').classList.add('active');
            
            // Set active tab
            event.target.classList.add('active');
        }
    </script>
</body>
</html>

